- test:
    timeout:
      minutes: {{ job_timeout|default(20) }}
    definitions:
    - from: inline
      name: "fault-injection-{{ test_name }}"
      path: inline/fault-injection.yaml
      repository:
        metadata:
          format: Lava-Test Test Definition 1.0
          name: fault-injection
          description: "Fault injection test: {{ test_name }}"
          os: [debian, ubuntu]
          scope: functional
        run:
          steps:
            - wget {{ failcmd_url }} -O /tmp/failcmd.sh
            - chmod +x /tmp/failcmd.sh
            - |
              for i in $(seq 1 {{ iterations }}); do
                echo "Iteration $i: {{ test_name }}"
                FAILCMD_TYPE={{ fail_type }} \
                  /tmp/failcmd.sh \
                  --probability={{ probability }} \
                  --times={{ times }} \
		  --interval={{ interval }} \
                  --verbose=2 \
                  "{{ test_command }}"
                sleep {{ sleep_time }}
              done
